name: Update Quote SVG

on:
  schedule:
    - cron: '0 0 * * *'  # 每天执行
  workflow_dispatch:

jobs:
  update-quote-svg:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Fetch quote and generate SVG
        run: |
          # 获取诗句
          QUOTE_DATA=$(curl -s 'https://v1.hitokoto.cn/?c=i')
          QUOTE=$(echo "$QUOTE_DATA" | jq -r '.hitokoto')
          SOURCE=$(echo "$QUOTE_DATA" | jq -r '.from')
          AUTHOR=$(echo "$QUOTE_DATA" | jq -r '.from_who')
          
          # 如果作者为空，使用"佚名"
          if [ "$AUTHOR" = "null" ]; then
            AUTHOR="佚名"
          fi
          
          # 生成SVG
          cat > .github/quote.svg << EOF
          <svg width="800" height="180" xmlns="http://www.w3.org/2000/svg">
            <style>
              .background {
                fill: #1a1b27;
                rx: 15;
                ry: 15;
              }
              .quote {
                font-family: 'FangSong', serif;
                font-size: 24px;
                font-weight: normal;
                fill: #a9b1d6;
                text-anchor: middle;
              }
              .author {
                font-family: 'KaiTi', serif;
                font-size: 18px;
                font-style: italic;
                fill: #7aa2f7;
                text-anchor: end;
              }
              .decoration {
                stroke: #7aa2f7;
                stroke-width: 1.5;
                opacity: 0.6;
              }
            </style>
            
            <rect width="100%" height="100%" class="background"/>
            
            <path d="M50,50 L750,50" class="decoration"/>
            <text x="400" y="100" class="quote">${QUOTE}</text>
            <path d="M50,130 L750,130" class="decoration"/>
            
            <text x="700" y="160" class="author">— ${AUTHOR}《${SOURCE}》</text>
          </svg>
          EOF
          
      - name: Commit and push if changed
        run: |
          git config --global user.name 'GitHub Actions'
          git config --global user.email 'actions@github.com'
          git add .github/quote.svg
          git diff --quiet && git diff --staged --quiet || git commit -m "Update daily quote SVG"
          git push
